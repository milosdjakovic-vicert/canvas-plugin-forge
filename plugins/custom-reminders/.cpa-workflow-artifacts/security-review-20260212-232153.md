# Security Review Report: custom-reminders

**Generated:** 2026-02-12 23:21:53
**Reviewer:** Claude Code (CPA)

## Summary

| Category | Status | Issues |
|----------|--------|--------|
| Plugin API Server Security | ⚠️ 2 low issues | XSS via innerHTML, unvalidated config input |
| FHIR API Client Security | N/A | No FHIR API client usage |
| Application Scope | ✅ Pass | Scopes correctly aligned |
| Secrets Declaration | ✅ Pass | All secrets declared, no hardcoded tokens |

## Detailed Findings

### Plugin API Server Security

**Authentication: PASS**
- `ReminderAPI` uses `StaffSessionAuthMixin` (recommended mixin approach) — all 7 endpoints require staff session authentication
- No manual `authenticate()` implementation (correct — mixin handles it)
- Location: `reminder_api.py:14`

**Finding 1: XSS via innerHTML in patient view (LOW)**
- Location: `reminder_api.py:717-722` (inline JS)
- The patient view renders cache-sourced data (`campaign_type`, `channel`, `status`) into the DOM via string concatenation with `innerHTML`
- Risk: LOW — values originate from server-side code in `messaging.py`, not user input. An attacker would need cache access to inject payloads.
- The admin page correctly uses `insertCell().textContent` for the same data (safe).
- Recommendation: Use `textContent` or DOM APIs instead of `innerHTML` for consistency and defense-in-depth

**Finding 2: Unvalidated config input on POST /admin/config (LOW)**
- Location: `reminder_api.py:577-578`
- `CampaignConfig.from_dict(data)` calls `cls(**data)` — any unexpected keys in the JSON body will cause a `TypeError`, returning a 500
- Risk: LOW — endpoint is staff-authenticated, and CampaignConfig is a simple dataclass with no dangerous fields
- Recommendation: Wrap in try/except or validate keys before constructing

### FHIR API Client Security

**N/A** — Plugin uses Canvas SDK data models (`Patient.objects`, `Appointment.objects`) via Django ORM, not direct FHIR API calls. The only `Authorization: Bearer` usage is for SendGrid's HTTP API (`messaging.py:97`), which correctly sources the key from secrets.

### Application Scope

| Application | Scope | Auth | Verdict |
|------------|-------|------|---------|
| `ReminderAdminApp` | `global` | `StaffSessionAuthMixin` | ✅ Correct — global admin tool, staff auth appropriate |
| `ReminderPatientApp` | `patient_specific` | `StaffSessionAuthMixin` | ✅ Correct — staff views patient data in chart context |

- No patient-facing apps using admin tokens (no risk)
- Patient history endpoint (`/patient/<patient_id>/history`) is accessible to any authenticated staff member, which matches Canvas's staff access model

### Secrets Declaration

**Manifest declares (5):**
- `twilio-account-sid`, `twilio-auth-token`, `twilio-phone-number`
- `sendgrid-api-key`, `sendgrid-from-email`

**Usage audit:**
- `reminder_api.py:564-565` — `self.secrets.get()` for all 5 secrets ✓
- `event_handler.py:56` — passes `self.secrets` dict to messaging ✓
- `reminder_scheduler.py:64` — passes `self.secrets` dict to messaging ✓
- `messaging.py:198-200, 211-216` — accesses all 5 via `secrets.get(key, "")` ✓

**No hardcoded tokens found.** All secret access uses `.get()` with empty-string defaults (no KeyError risk, enables dry-run mode).

## Recommendations

| Priority | Issue | Location | Recommendation |
|----------|-------|----------|----------------|
| LOW | XSS via innerHTML | `reminder_api.py:717-722` (JS) | Use textContent/DOM APIs instead of innerHTML string concatenation |
| LOW | Unvalidated config POST | `reminder_api.py:577-578` | Add try/except around `CampaignConfig.from_dict(data)` |

## Verdict

**✅ PASS** — No HIGH or MEDIUM security issues found. Two LOW-priority improvements recommended for defense-in-depth.
